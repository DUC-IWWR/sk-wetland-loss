---
title: "Modelling Wetland Loss in Saskatchewan"
format: html
---

## Introduction

The purpose of this report is to demonstrate the modelled loss of wetlands in Saskatchewan,
based on GIS data collected by the CWI. This will then be compared to drainage data collected by WSA.

## Data Exploration

Let us first explore the data. Here we will focus on the data generated by the CWI and stratified by 
virtual basin. Let's take a look at some histograms and potential relationships to investigate.

### Distribution of Drain Lengths and Numbers of Drains
```{r}
#| echo: false
targets::tar_load(vb_db)
```
Let's first take a look at the distribution of drain lengths and the distribution of the number of drains. 
Note here that I am only looking at virtual basins where the drain lengths are greater than 0, or the 
number of drains are greater than 0. That is, we aren't considering undrained virtual basins. This 
also gets rid of incomplete data.

We will also look to see if there is a relationship between number of drains and the length of drains 
per virtual basin. We would likely expect to see a positive relationship (i.e., more drains implies 
more length of drain per virtual basin).
 
```{r}
#| echo: false
targets::tar_load(combined_drains_plot)
print(combined_drains_plot)
```

We can see a fairly clear relationship between the number of drains and the length of drains per virtual basin. 
In fact, we find a correlation of `r cor(vb_db$sum_Length, vb_db$Polyline_C)`. With this in 
mind, we can probabl be confident that we can use either of these two variables in a model as they are effectively 
telling the same story.

### Distribution of Drained Area by CWI Class

Let us now take a look at the distribution of drained area by CWI class. For this, I will present the distribution 
of percent drained virtual basin for classes 1 and 5. This is because the virtual basins are of different sizes, 
and so we should expect to see more drainage in larger basins. So, taking the percent drained per basin 
standardizes the drainage.

Here are the percent drainage for CWI classes 1 and 5:
```{r}
#| echo: false
targets::tar_load(combined_class_drainage_plot)
print(combined_class_drainage_plot)
```

Across the virtual basins for which we have data, we find a total drained area of 
`r round(sum(vb_db$CWI_1, na.rm = TRUE) + sum(vb_db$CWI_5, na.rm = TRUE), 2)`km^2, which comprises a total of 
`r round(((sum(vb_db$CWI_1, na.rm = TRUE) + sum(vb_db$CWI_5, na.rm = TRUE)) / sum(vb_db$CWI_Total, na.rm = TRUE)) * 100 ,2)`%.

### Spatial Distribution of Drainage

Let's take a look at how the drainage varies in space. For now, we will just colour points by drainage amount 
until I can get access to the virtual drainage shapefiles. Also note that I will standardize the 
drainage amount (whether it be number of drains, length of drains, or drained area) by area of each
virtual basin. That will allow us to see if there are any hotspots (or coldspots) of drainage that are not
necessarily influenced by the size of the drainage ditch. We would expect larger virtual basins to have
more drainage if this is strictly a process by amount of land.

First, let us see the spatial distribution of the number of drains per square kilometer in each VB, recalling
that the number of drains can be used as a proxy for length of drains.

```{r}
#| echo: false
targets::tar_load(drains_per_sq_km_plot)
print(drains_per_sq_km_plot)
```

And now the percent drained wetlands at each virtual basin (grey dots denote NA): 

```{r}
#| echo: false
targets::tar_load(drainage_per_sq_km_plot)
print(drainage_per_sq_km_plot)
```
